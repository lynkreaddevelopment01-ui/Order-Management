<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Login | Medical Order Management</title>
  <meta name="description" content="Admin login for the Medical Order Management System">
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <style>
    /* Tabs Styling */
    .login-tabs {
      display: flex;
      background: var(--neutral-100);
      padding: 4px;
      border-radius: var(--radius-lg);
      margin-bottom: 24px;
    }

    .tab-btn {
      flex: 1;
      padding: 10px;
      border: none;
      background: transparent;
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--text-muted);
      cursor: pointer;
      border-radius: var(--radius-md);
      transition: all 0.2s;
    }

    .tab-btn.active {
      background: white;
      color: var(--primary-600);
      box-shadow: var(--shadow-sm);
    }
  </style>

  <div class="customer-login-page">
    <div class="login-card fade-in-up">
      <div class="login-logo">üè•</div>
      <h1>Medical Orders</h1>

      <div class="login-tabs">
        <button class="tab-btn active" id="adminTab" onclick="switchLoginTab('admin')">Admin</button>
        <button class="tab-btn" id="customerTab" onclick="switchLoginTab('customer')">Customer</button>
      </div>

      <!-- Admin Login Form -->
      <div id="adminFormSection">
        <p class="login-sub">Admin Panel ‚Äî Sign in to continue</p>
        <form id="loginForm">
          <div class="form-group">
            <label class="form-label" for="username">Username</label>
            <input type="text" class="form-control" id="username" name="username" placeholder="Enter your username"
              required autocomplete="username">
          </div>
          <div class="form-group">
            <label class="form-label" for="password">Password</label>
            <input type="password" class="form-control" id="password" name="password" placeholder="Enter your password"
              required autocomplete="current-password">
          </div>
          <div id="loginError"
            style="color: var(--danger-500); font-size: 0.85rem; margin-bottom: 10px; display: none;"></div>
          <button type="submit" class="btn btn-primary btn-lg" id="loginBtn" style="width:100%;">
            Sign In
          </button>
        </form>
      </div>

      <!-- Customer Login Form -->
      <div id="customerFormSection" style="display: none;">
        <p class="login-sub">Enter your details to place an order</p>
        <form id="customerLoginForm">
          <div class="form-group">
            <label class="form-label" for="vendorCode">Vendor/Company Code</label>
            <input type="text" class="form-control" id="vendorCode" placeholder="e.g. d92e3448" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="custId">Customer ID</label>
            <input type="text" class="form-control" id="custId" placeholder="Your Customer ID" required>
          </div>
          <div id="custLoginError"
            style="color: var(--danger-500); font-size: 0.85rem; margin-bottom: 10px; display: none;"></div>
          <button type="submit" class="btn btn-primary btn-lg" id="custLoginBtn" style="width:100%;">
            Continue ‚Üí
          </button>
        </form>
      </div>
    </div>
  </div>

  <div class="toast-container" id="toastContainer"></div>

  <script>
    function switchLoginTab(type) {
      const adminTab = document.getElementById('adminTab');
      const customerTab = document.getElementById('customerTab');
      const adminSection = document.getElementById('adminFormSection');
      const customerSection = document.getElementById('customerFormSection');

      if (type === 'admin') {
        adminTab.classList.add('active');
        customerTab.classList.remove('active');
        adminSection.style.display = 'block';
        customerSection.style.display = 'none';
      } else {
        adminTab.classList.remove('active');
        customerTab.classList.add('active');
        adminSection.style.display = 'none';
        customerSection.style.display = 'block';
      }
    }

    // Admin Login Logic
    const loginForm = document.getElementById('loginForm');
    const loginError = document.getElementById('loginError');
    const loginBtn = document.getElementById('loginBtn');

    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      loginBtn.disabled = true;
      loginBtn.textContent = 'Signing in...';
      loginError.style.display = 'none';

      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value;

      try {
        const res = await fetch('/api/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, password })
        });
        const data = await res.json();

        if (data.success) {
          localStorage.setItem('token', data.token);
          localStorage.setItem('user', JSON.stringify(data.user));
          window.location.href = '/admin/dashboard';
        } else {
          loginError.textContent = data.error || 'Login failed';
          loginError.style.display = 'block';
        }
      } catch (err) {
        loginError.textContent = 'Network error. Please try again.';
        loginError.style.display = 'block';
      }

      loginBtn.disabled = false;
      loginBtn.textContent = 'Sign In';
    });

    // Customer Login Logic
    document.getElementById('customerLoginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const vendorCode = document.getElementById('vendorCode').value.trim();
      const custId = document.getElementById('custId').value.trim();
      const errorEl = document.getElementById('custLoginError');
      const btn = document.getElementById('custLoginBtn');

      errorEl.style.display = 'none';
      btn.disabled = true;
      btn.textContent = 'Verifying...';

      try {
        const res = await fetch('/api/customer/verify', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ uniqueCode: vendorCode, customerId: custId })
        });
        const data = await res.json();

        if (data.success) {
          // Store data and redirect to the vendor-specific order page
          localStorage.setItem('customer_auth', JSON.stringify({
            vendorCode,
            customerId: custId,
            customerData: data.customer
          }));
          window.location.href = `/order/${vendorCode}`;
        } else {
          errorEl.textContent = data.error || 'Identity verification failed';
          errorEl.style.display = 'block';
        }
      } catch (err) {
        errorEl.textContent = 'Network error. Please try again.';
        errorEl.style.display = 'block';
      }
      btn.disabled = false;
      btn.textContent = 'Continue ‚Üí';
    });
  </script>
</body>

</html>